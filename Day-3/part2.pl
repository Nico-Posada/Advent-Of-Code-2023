#!perl -p
push@s,$_;push@{$h{$.}},"$& @- @+"while/\d+/g}{s/\*/@a=map{grep{@p=split;$p[1]-2<"@-"<=$p[2]}@{$h{$y+$_}}}0..2;$t+="@a"*$a[1]if@a==2/eg,$y++for@s;$_=$t
